<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Agregar nuevo usuario</title>
        <link rel="stylesheet" href="estilos.css">
    </head>
    <body>
        <header>
            <h1>Agregue un nuevo usuario</h1>
        </header>
        <div class="container">
            <div class="sidebar">
                <br><button onclick="location.href='admin.html'">Volever al menú</button><br>
                <button onclick="location.href='agregar_usuario.html'">Crear nuveo usuario</button><br>
                <button onclick="location.href='crear_actividad.html'">Crear nueva actividad</button><br>
                <button onclick="location.href='Modificar_actividades.html'">Modificar actividades</button><br>
                <button onclick="location.href='eliminar_actividad.html'">Eliminar actividad</button><br>
                <button onclick="location.href='monitorear_actividad'">Monitorear progreso</button><br>
                <button onclick="location.href='generar_reporte.html'">Generar reporte de actividades</button>
            </div>
            <div class="main">
                <label for="nombre">Ingrese el nombre:</label>
                <input type="text" id="nombre" required>

                <label for="nombre">Teléfono:</label>
                <input type="text" id="telefono" required>

                <label for="direccion">Dirección:</label>
                <input type="text" id="direccion" required>
                
                <label for="rol">Asigne un rol:</label>
                <select id="rol">
                    <option>Administrador</option>
                    <option>Empleado</option>
                    </select>

                <label for="area">Área perteneciente:</label>
                <input type="text" id="area" required>

                <label for="usuario">Nombre de usuario:</label>
                <input type="text" id="usuario" required>

                <label for="contrasena">Contraseña:</label>
                <input type="password" id="contrasena" required>

                <div class="buttons">
                    <button onclick="crearUsuario()">Confirmar creación de usario</button>
                    <button onclick="location.reload()">Cancelar</button>
                </div>
            </div>
        </div>

        <script>
        document.addEventListener("DOWContentLoaded", () => {
            const token = localStorage.getItem('token');
            const rol = localStorage.getItem("rol");

            if (!token || rol !== 'Administrador') {
                alert('Acceso denegado. Debes iniciar sesión como administrador.');
                window.location.href = 'inicio_sesion.html'
            }
        });

        async function crearUsuario() {
            const nombre = document.getElementById("nombre").value.trim();
            const telefono = document.getElementById("telefono").value.trim();
            const direccion = document.getElementById("direccion").value.trim();
            const rol = document.getElementById("rol").value;
            const area = document.getElementById("area").value.trim();
            const usuario = document.getElementById("usuario").value.trim();
            const contrasena = document.getElementById("contrasena").value.trim();

            // Validar campos
            if (!nombre || !telefono || !direccion || !rol || !area || !usuario || !contrasena) {
                alert("Por favor completa todos los campos.");
                return;
            }

            if (!/^\d{10}$/.test(telefono)) {
                alert("El teléfono debe tener exactamente 10 dígitos numéricos.");
                return;
            }

            try {
                const response = await fetch("https://backend-actividad-fvub.onrender.com/api/users/crear", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        nombre,
                        telefono,
                        direccion,
                        rol,
                        area,
                        usuario,
                        contrasena
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert("Usuario creado exitosamente.");
                    window.location.href = "admin.html";
                } else {
                    alert("Error: " + (data.message || "No se pudo crear el usuario"));
                }
            } catch (error) {
                console.error("Error al crear usuario:", error);
                alert("Error de conexión al servidor.");
            }
        }
    </script>
    </body>
</html>