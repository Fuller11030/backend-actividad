<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Eliminar actividad</title>
        <link rel="stylesheet" href="estilos.css">
    </head>
    <body>
        <header>
            <h1>Eliminar actividad</h1>
        </header>
    
    <div class="container">
        <div class="sidebar">
            <br><button onclick="location.href='admin.html'">Volver al menú</button><br>
            <button onclick="location.href='agregar_usuario.html'">Crear nuevo usuario</button><br>
            <button onclick="location.href='crear_actividad.html'">Crear nueva actividad</button><br>
            <button onclick="location.href='Modificar_actividades.html'">Modificar actividades</button><br>
            <button onclick="location.href='eliminar_actividad.html'">Eliminar actividades</button><br>
            <button onclick="location.href='monitorear_actividad.html'">Monitorear progreso</button><br>
            <button onclick="location.href='generar_reporte.html'">Generar reporte de actividades</button><br>
            <button onclick="cerrarSesion()">Cerrar sesión</button>
        </div>
        <div class="main">
            <label for="actividad">Nombre de la actividad</label>
            <input type="text" id="actividad"><br><br>

        <br><br><div class="buttons">
            <button onclick="location.reload()">Cancelar</button>
            <button onclick="eliminarActividad()">Elimnar</button>
        </div>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
      const token = localStorage.getItem('token');
      const rol = localStorage.getItem("rol");

      if (!token || rol !== 'Administrador') {
        alert('Acceso denegado. Debes iniciar sesión como administrador.');
        window.location.href = 'inicio_sesion.html';
      }
    });

    async function eliminarActividad() {
      const nombre = document.getElementById("actividad").value.trim();

      if (!nombre) {
        alert("Debes escribir el nombre de la actividad.");
        return;
      }

      const confirmacion = confirm(`¿Estás seguro de eliminar la actividad "${nombre}"?`);
      if (!confirmacion) return;

      try {
        const res = await fetch("https://backend-actividad-fvub.onrender.com/api/activities/eliminar-actividad", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ nombre })
        });

        const data = await res.json();
        if (res.ok) {
          alert("Actividad eliminada correctamente.");
          window.location.href = "admin.html";
        } else {
          alert("Error: " + (data.mensaje || "Error desconocido"));
        }
      } catch (err) {
        console.error(err);
        alert("Error de conexión con el servidor.");
      }
    }

    function cerrarSesion() {
      localStorage.removeItem("token");
      localStorage.removeItem("rol");
      localStorage.removeItem("nombre");
      window.location.href = "inicio_sesion.html";
    }
  </script>
    </body>
</html>